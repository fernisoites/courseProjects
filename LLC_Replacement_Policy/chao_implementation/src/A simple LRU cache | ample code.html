<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<title>A simple LRU cache | ample code</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="https://einarwh.wordpress.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="ample code &raquo; Feed" href="https://einarwh.wordpress.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="ample code &raquo; Comments Feed" href="https://einarwh.wordpress.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="ample code &raquo; A simple LRU&nbsp;cache Comments Feed" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
	<link rel='stylesheet' id='all-css-0' href='https://s1.wp.com/_static/??-eJyNke1KQzEMhm/IWDanuB/itfQj6+mWnJTTdGV3b8+GKJsU/4S84XkIaU3L4GVWnNVwhUw1prmYlr0wFE6El7v07Et5Mn9rlE5YzBE1W3+Ca3rAHUn8ESRGDFIVDkIkzbQUIupYarIEG4qJJM7S/1hPaGeYhBHO29EJC5JVDJCl6F0aaV4W7HPOVleCMSSLhNyxkcb57dta26k/23DN7SecywuWAr1yqgw69UWP3m1scnW/zjdFL4Qr+8kfm93rfrvb7F/ej1+efsNV' type='text/css' media='all' />
<!--[if IE]>
<link rel='stylesheet' id='cleanhome-ie-css'  href='https://s0.wp.com/wp-content/themes/pub/clean-home/ie.css?m=1291819101h&#038;ver=4.4.3-RC1' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='all-css-2' href='https://s1.wp.com/_static/??-eJx9i9EKwjAMRX/IGAYV9UH8lq7ELqNJytoy/HsrA5kve7mcC+fgmiGYVtKKdSKhgrmNGBJ5hcmEkDVgqe9EsOZgcg6lnHBXSYOcWmQtSGIzb7tpjGqVu1l+cNRHMkgWfGXTvwOv5Hk5Shcak8WOEbu1u9/oKY/BXe7O3a6Dmz+ELFn0' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-3' href='https://s1.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1444132114h' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-4' href='https://s0.wp.com/_static/??-eJx1i0EKgCAQRS+UTYJQLaKzWExq6CiO0vWrRatq9T68/+BIYo1UkAqEKpKvxhFDilzE5rXLwFZnR+ZhuzI38F0ZJMzuEj/z1RaLARmsAuPjov19mMMklRr7rpfDuJ8lmzr3' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type='text/javascript' src='https://s2.wp.com/_static/??-eJyFj90OwiAMhV9IJJvzwgvjs2yjI0WgSEGiTy9L1MS5aNKkf985aWUJAv1oswKWpsYlQ7w909bwRv4ChEMd+wRbh/4Fj+QT+DSzjga0IDJD7HWdVaOJVrhAnBwwV2hl+3kS+itC+YsZSKEfzyIC4/3LdbCkRbBZo2dZaw2KchITWUtFFlQa0lLj8lsRwdanlZjvXnRVdXLHput2bdscmr15AHGYhE4='></script>
<link rel='stylesheet' id='all-css-0' href='https://s1.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1377793621h' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s1.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://einarwh.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='next' title='Polymorphic pain in ASP.NET data&nbsp;binding' href='https://einarwh.wordpress.com/2011/04/17/polymorphic-pain-in-aspnet-data-binding/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/" />
<link rel='shortlink' href='http://wp.me/p7Bb2-1L' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=json&amp;url=https%3A%2F%2Feinarwh.wordpress.com%2F2011%2F04%2F13%2Fa-simple-lru-cache%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=xml&amp;url=https%3A%2F%2Feinarwh.wordpress.com%2F2011%2F04%2F13%2Fa-simple-lru-cache%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="A simple LRU cache" />
<meta property="og:url" content="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/" />
<meta property="og:description" content="Disclaimer: copy code from this site at your own peril!So yeah, I wanted to share this simple LRU cache I put together. LRU means &#8220;least-recently-used&#8221;. The idea is that you want to keeâ€¦" />
<meta property="article:published_time" content="2011-04-13T21:08:00+00:00" />
<meta property="article:modified_time" content="2013-02-28T09:14:07+00:00" />
<meta property="og:site_name" content="ample code" />
<meta property="og:image" content="https://einarwh.files.wordpress.com/2011/04/lru-cache-scaled500.png?w=300" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:image" content="https://einarwh.files.wordpress.com/2011/04/lru-cache-scaled500.png?w=240" />
<meta name="twitter:card" content="summary" />
<meta property="fb:app_id" content="249643311490" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />
<link rel="shortcut icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon-precomposed" href="https://s0.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://einarwh.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://einarwh.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://einarwh.wordpress.com/osd.xml" title="ample code" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
<meta name="application-name" content="ample code" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Journeyman wizardry and smoke rings in code" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://einarwh.wordpress.com/feed/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico" /><meta name="title" content="A simple LRU&nbsp;cache | ample code on WordPress.com" />
<meta name="description" content="Disclaimer: copy code from this site at your own peril!So yeah, I wanted to share this simple LRU cache I put together. LRU means &quot;least-recently-used&quot;. The idea is that you want to keep the hottest, most useful elements in the cache, so you evict..." />
		<script type="text/javascript" src="//c.amazon-adsystem.com/aax2/amzn_ads.js"></script>
		<script type="text/javascript">
		try { amznads.getAds("3033"); } catch(e) { /* ignore */ }
		</script>
		<script type="text/javascript">
		try {
			var a9_p = amznads.getKeys(),
			_ipw_custom = {
				wordAds: '0',
				adSafe: '0',
				domain: 'einarwh.wordpress.com',
				pageURL: 'https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/'
			};
			if("undefined"!=typeof a9_p&&""!=a9_p&&null!==a9_p&&"[object Array]"===Object.prototype.toString.call(a9_p)){var a="",b=0,c=a9_p.length;a9_p.sort();for(var d=0;d<c;d++){a9_p[d-b]=a9_p[d-b].replace(/a1x6p/,"a160x600p");var e=a9_p[d-b].split("p");e[0]==a&&(a9_p.splice(d-b,1),b++);a=e[0]}_ipw_custom.amznPay=a9_p};document.close();
		} catch(e) {}
		</script>		<!-- IPONWEB header script -->
		<script type="text/javascript">
			window.__ATA = {
				scriptSrc: '//s.pubmine.com/showad.js',
				slotPrefix: 'automattic-id-',
				initAd: function(o) {
					var o = o || {},
						g = window,
						d = g.document,
						wr = d.write,
						id = g.__ATA.id();
					wr.call(d, '<div id="' + id + '" data-section="' + (o.sectionId || 0) + '"' + (o.type ? ('data-type="' + o.type + '"') : '') + ' ' + (o.forcedUrl ? ('data-forcedurl="' + o.forcedUrl + '"') : '') + ' style="width:' + (o.width || 0) + 'px; height:' + (o.height || 0) + 'px;">');
					g.__ATA.displayAd(id);
					wr.call(d, '</div>');
				},
				displayAd: function(id) {
					window.__ATA.ids = window.__ATA.ids || {};
					window.__ATA.ids[id] = 1;
				},
				customParams: _ipw_custom,
				id: function() {
					return window.__ATA.slotPrefix + (parseInt(Math.random() * 10000, 10) + 1 + (new Date()).getMilliseconds());
				}
			};
			(function(d, ata) {
				var pr = "https:" === d.location.protocol ? "https:" : "http:",
					src = pr + ata.scriptSrc,
					st = "text/javascript";
				d.write('<scr' + 'ipt type="' + st + '" src="' + src + '"><\/scr' + 'ipt>');
			})(window.document, window.__ATA);
		</script>
		<script type="text/javascript">
		jQuery(window).ready(function () {
			jQuery("a.wpa-about").text("About these ads");
		});
		</script><link rel="amphtml" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/amp/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script>
</head>

<body class="single single-post postid-109 single-format-standard mp6 customizer-styles-applied color-light highlander-enabled highlander-light">

<div id="wrapper">

	<div class="header">
		<div id="logo">
		<h1><a href="https://einarwh.wordpress.com">ample code</a></h1>
		<h2>Journeyman wizardry and smoke rings in code</h2>
		</div>

		<div id="nav">
			<ul>
	<li class="page_item page-item-2"><a href="https://einarwh.wordpress.com/about/">About</a></li>
</ul>
		</div>

			</div>

	
	<div class="content">
	
		
		<div class="navigation nav-above">
			<div class="alignleft">&larr; <a href="https://einarwh.wordpress.com/2011/04/17/polymorphic-pain-in-aspnet-data-binding/" rel="next">Polymorphic pain in ASP.NET data&nbsp;binding</a></div>
			<div class="alignright"></div>
		</div>

		<div class="post-109 post type-post status-publish format-standard hentry category-programming tag-algorithms tag-c tag-caching tag-net" id="post-109">
			<h1>A simple LRU&nbsp;cache</h1>
			<small class="post-meta"><span class="post-date"><b>Posted:</b> April 13, 2011</span> <span class="author-link">| <b>Author:</b> <a href="https://einarwh.wordpress.com/author/einarwh/" title="Posts by Einar" rel="author">Einar</a></span> <span class="meta-sep">|</span> <span class="cat-links"><b>Filed under:</b> <a href="https://einarwh.wordpress.com/category/programming/" rel="category tag">Programming</a></span> <span class="tag-links"> | <b>Tags:</b> <a href="https://einarwh.wordpress.com/tag/algorithms/" rel="tag">algorithms</a>, <a href="https://einarwh.wordpress.com/tag/c/" rel="tag">c</a>, <a href="https://einarwh.wordpress.com/tag/caching/" rel="tag">caching</a>, <a href="https://einarwh.wordpress.com/tag/net/" rel="tag">net</a></span> <span class="edit-link"></span> <span class="meta-sep">|</span><span class="comments-link"><a href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/#comments">1 Comment</a></span></small>
			<p><span style="color:#ff0000;">Disclaimer: copy code from this site at your own peril!</span></p>
<p>So yeah, I wanted to share this simple LRU cache I put together. LRU means &#8220;least-recently-used&#8221;. The idea is that you want to keep the hottest, most useful elements in the cache, so you evict elements that haven&#8217;t been used for a while. It&#8217;s a useful approximation of Belady&#8217;s algorithm (aka the clairvoyant algorithm) in many scenarios. Wikipedia has all <a href="http://en.wikipedia.org/wiki/Cache_algorithms">the details</a>.</p>
<p>Of course, my LRU implementation (written in C#) is extremely simple, naive even. For instance, it&#8217;s not self-pruning, meaning there&#8217;s no threading or callback magic going on to make sure that elements are evicted as soon as they expire. Rather, you check for expired elements when you interact with the cache. This incurs a little bit of overhead for each operation. Also, it means that if you don&#8217;t touch the cache, elements linger there forever. Another name for that would be &#8220;memory leak&#8221;, which sounds less impressive than &#8220;LRU cache&#8221;, but there you go. (We&#8217;re going off on a tangent here. Why would you create a cache that you never use? So let&#8217;s assume that you&#8217;re going to use it. &#8220;Useful&#8221; sort of implies &#8220;use&#8221;, indeed it should be &#8220;ful&#8221; of it.)</p>
<p>(The implementation isn&#8217;t synchronized either, which means you could wreak havoc if you have multiple threads accessing it simultaneously. But of course, you would be anyway. None of us can write correct multi-threaded code, so we should just refrain from doing so until the STM angel arrives to salvage us all. I believe his name is &#8220;<a href="http://channel9.msdn.com/Shows/Going+Deep/Programming-in-the-Age-of-Concurrency-Software-Transactional-Memory">Simon</a>&#8220;.)</p>
<p>Anyways, the basic idea of an LRU cache is that you timestamp your cache elements, and use the timestamps to decide when to evict elements. To do so efficiently, you do two kinds of book-keeping: one for lookup, another for pruning of expired elements. In my implementation, this translates to a hash table and a linked list. The linked list is sorted by age, making it easy to find the oldest elements. New elements are added to the front, elements are pruned from the back. Pretty simple. I&#8217;ve sketched it below, just in case you cannot read.</p>
<div class="p_embed p_image_embed"><img alt="Lru-cache" src="https://einarwh.files.wordpress.com/2011/04/lru-cache-scaled500.png?w=414&#038;h=213" width="414" height="213" /></div>
<p>The cache in the figure holds five elements, two of which have expired. To be extraordinarily pedagogical, I&#8217;ve colored those red. The still-fresh elements are green. Notice that there are arrows going both ways between the hash table and the list. We&#8217;ll be using both to do our double book-keeping.</p>
<p>Now, let&#8217;s look at the implementation details. Performance-wise, we want to keep everything nice and O(1), with the caveat that there&#8217;ll be a little book-keeping going on. It shouldn&#8217;t be too bad, there&#8217;s not much to do.</p>
<p><span style="font-size:medium;">Overview</span></p>
<p>A skeletal view of the <strong>ExpirationCache</strong> class looks like this:</p>
<p><script src="https://gist.github.com/5055376.js"></script></p>
<p>There&#8217;s a fair amount of generic noise there, but the important stuff should be graspable. We can see the hash table (i.e. the Dictionary) and the linked list, as well as the TimeSpan which determines how long items should be held in the cache before expiring. The type declaration reveals that the cache holds elements of type <strong>TValue</strong>, that are accessed by keys of type <strong>TKey</strong>.</p>
<p>The <strong>TimeStamped </strong>type is simply a way of adding a timestamp to any ol&#8217; type, like so:</p>
<p><script src="https://gist.github.com/5055380.js"></script></p>
<p><span style="font-size:medium;">Pruning</span></p>
<p>Let&#8217;s look at something a bit more interesting: the pruning. (Of course, I don&#8217;t know if caches can really be &#8220;pruned&#8221;, as they&#8217;re not plants. But programming is the realm of mangled metaphors, so we&#8217;ll make do.) Here&#8217;s the <strong>Prune</strong> method:</p>
<p><script src="https://gist.github.com/5055385.js"></script></p>
<p>The linked list is the tool we use for pruning. We iterate over the list backwards, starting with the last and oldest element. If the element has expired, we need to remove it from both the linked list and the dictionary. Of course, these operations must be O(1), or we&#8217;re toast. Removing the current node from a linked list is not a problem, but what about the dictionary? We need access to the key, so the linked list node needs to contain that. Once we have that, we&#8217;re good. We stop iterating once we reach an element that hasn&#8217;t expired yet. The neat thing is that we never look at more than a single non-expired element, since the list is sorted by age.</p>
<p>There are plenty of variations that you might consider. You might want to pose a strict limit on the number of elements, for instance. You might use that instead of, or in conjunction with, the expiration time.</p>
<p>How aggressively should we be pruning the cache? In my implementation, I prune on all operations, including counting elements in the cache. But you could choose different approaches. For instance, if you don&#8217;t mind serving slightly stale elements, you could prune only when adding. Speaking of adding: what happens when you add an element to the cache?</p>
<p><span style="font-size:medium;">Adding</span></p>
<p>There are two scenarios to consider when adding an element to the cache: 1) adding a new element, and 2) replacing an existing element. Let&#8217;s look at the code to see how it&#8217;s done.</p>
<p><script src="https://gist.github.com/5055390.js"></script></p>
<p>After the mandatory pruning step is done, we can do what we&#8217;re here for. Let&#8217;s assume we&#8217;re adding a new element first. It&#8217;s trivial, even though we need to nest a few type envelopes: we&#8217;re wrapping our element in a <strong>TimeStamped </strong>inside a <strong>KeyValuePair </strong>inside a <strong>LinkedListNode</strong>. Then we just put that in front of the list (because it&#8217;s our newest one), and add it to the dictionary. Replacing an existing element is not much harder; we just remove it before adding it. We can&#8217;t mutate it, since we need a new timestamp and &#8211; more importantly &#8211; a new position in the linked list. We can&#8217;t afford to shuffle things around, since we&#8217;d lose O(1) in a heartbeat.</p>
<p><span style="font-size:medium;">Look up</span></p>
<p>There isn&#8217;t much to it, really. Look up is a pure hash table operation:</p>
<p><script src="https://gist.github.com/5055393.js"></script></p>
<p>Of course, you need open up all those type envelopes, too. But that&#8217;s pretty much it. For convenience, it&#8217;s nice to add an indexer, like so:</p>
<p><script src="https://gist.github.com/5055395.js"></script></p>
<p><span style="font-size:medium;">Wrapping up</span></p>
<p>And we&#8217;re done! If you think the implementation sucks or is flat-out broken, please tell me why.</p>
		<div class="wpcnt">
			<div class="wpa wpmrec">
				<a class="wpa-about" href="https://wordpress.com/about-these-ads/" rel="nofollow"></a>
				<div class="u">
					<script type='text/javascript'>
					(function(g){g.__ATA.initAd({sectionId:26942, width:300, height:250});})(window);
					</script>
				</div>
			</div>
		</div><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-109" class="share-twitter sd-button share-icon" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-109" class="share-facebook sd-button share-icon" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/?share=facebook" target="_blank" title="Share on Facebook"><span>Facebook</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-109" class="share-google-plus-1 sd-button share-icon" href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/?share=google-plus-1" target="_blank" title="Click to share on Google+"><span>Google</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-1811208-109-57009667b951b' data-src='//widgets.wp.com/likes/#blog_id=1811208&amp;post_id=109&amp;origin=einarwh.wordpress.com&amp;obj_id=1811208-109-57009667b951b' data-name='like-post-frame-1811208-109-57009667b951b'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>						<hr/>
		</div>

		
<div id="comments">


	<h3>One Comment on &#8220;A simple LRU&nbsp;cache&#8221;</h3>

	<div class="navigation">
			</div>

	<ol class="commentlist">
				<li class="comment even thread-even depth-1 highlander-comment" id="comment-13">
				<div id="div-comment-13" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://0.gravatar.com/avatar/?s=26&#038;d=identicon' class='avatar avatar-26' height='26' width='26' />			<cite class="fn">Anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/#comment-13">
			October 29, 2011 at 4:52 am</a>		</div>

		<p>sweet!!</p>

		
				</div>
		</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
			</div>

	


<hr/>

				<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2011/04/13/a-simple-lru-cache/#respond" style="display:none;">Cancel reply</a></small></h3>		<form action="https://einarwh.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
														


						<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="04b1adf3e2" /><input type="hidden" name="_wp_http_referer" value="/2011/04/13/a-simple-lru-cache/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity" class="comment_registration">

	<div id="comment-form-nascar">
		<p>Please log in using one of these methods to post your comment:</p>
		<ul>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="https://public-api.wordpress.com/connect/?googleplus-sign-in=https%3A%2F%2Feinarwh.wordpress.com" width="24" height="24" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0"></iframe>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text" value="" /></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y" alt="Google+ photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;" tabindex="6"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p></div>

						<p class="form-submit">
				<input name="submit" type="submit" id="comment-submit" value="Post Comment" />
				<input type='hidden' name='comment_post_ID' value='109' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
			</p>
			<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a8fdb6d146" /></p>
<input type="hidden" name="genseq" value="1459656295" />
<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="195"/></p>		</form>
		</div><!-- #respond -->
		<div style="clear: both"></div>

</div>

		
		<div class="navigation">
			<div class="alignleft">&larr; <a href="https://einarwh.wordpress.com/2011/04/17/polymorphic-pain-in-aspnet-data-binding/" rel="next">Polymorphic pain in ASP.NET data&nbsp;binding</a></div>
			<div class="alignright"></div>
		</div>

	
	</div>

	<div id="sidebar">
		
							<div class="block">
				<h3>Recent Posts</h3>
				<ul>
														<li><a href="https://einarwh.wordpress.com/2016/03/10/pragmatism-is-poison/">Pragmatism is poison</a></li>
														<li><a href="https://einarwh.wordpress.com/2016/01/29/strings-with-assumptions/">Strings with assumptions</a></li>
														<li><a href="https://einarwh.wordpress.com/2015/12/05/technical-debt-isnt-technical/">Technical debt isn&#8217;t&nbsp;technical</a></li>
														<li><a href="https://einarwh.wordpress.com/2015/05/10/thinging-names/">Thinging names</a></li>
														<li><a href="https://einarwh.wordpress.com/2015/02/10/diamond-mirrors/">Diamond mirrors</a></li>
												</ul>
			</div>
		
		<div class="block">
			<h3>Archives</h3>
				<ul>
					<li><a href='https://einarwh.wordpress.com/2016/03/'>March 2016</a></li>
	<li><a href='https://einarwh.wordpress.com/2016/01/'>January 2016</a></li>
	<li><a href='https://einarwh.wordpress.com/2015/12/'>December 2015</a></li>
	<li><a href='https://einarwh.wordpress.com/2015/05/'>May 2015</a></li>
	<li><a href='https://einarwh.wordpress.com/2015/02/'>February 2015</a></li>
	<li><a href='https://einarwh.wordpress.com/2014/07/'>July 2014</a></li>
	<li><a href='https://einarwh.wordpress.com/2014/06/'>June 2014</a></li>
	<li><a href='https://einarwh.wordpress.com/2013/12/'>December 2013</a></li>
	<li><a href='https://einarwh.wordpress.com/2013/11/'>November 2013</a></li>
	<li><a href='https://einarwh.wordpress.com/2013/03/'>March 2013</a></li>
	<li><a href='https://einarwh.wordpress.com/2013/02/'>February 2013</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/11/'>November 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/08/'>August 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/07/'>July 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/06/'>June 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/05/'>May 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2012/01/'>January 2012</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/11/'>November 2011</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/10/'>October 2011</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/09/'>September 2011</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/06/'>June 2011</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/05/'>May 2011</a></li>
	<li><a href='https://einarwh.wordpress.com/2011/04/'>April 2011</a></li>
				</ul>
		</div>

		<div class="block">
			<h3>Categories</h3>
				<ul>
						<li class="cat-item cat-item-196"><a href="https://einarwh.wordpress.com/category/programming/" >Programming</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://einarwh.wordpress.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-20532"><a href="https://einarwh.wordpress.com/category/whimsy/" >Whimsy</a>
</li>
				</ul>
		</div>

		<div class="block">
					</div>

		</div>
			<div id="footer">
				<a href="https://wordpress.com/?ref=footer_website">Create a free website or blog at WordPress.com.</a>
				<a href="https://wordpress.com/themes/clean-home/" title="Learn more about this theme">The Clean Home Theme</a>.			</div><!-- #footer -->
			<!-- wpcom_wp_footer -->
	<div style="display:none">
	<div class="grofile-hash-map-d41d8cd98f00b204e9800998ecf8427e">
	</div>
	</div>
<script type='text/javascript'>
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/einarwh.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/einarwh.wordpress.com\/wp-login.php?action=logout&_wpnonce=4a90ccbf04","homeURL":"https:\/\/einarwh.wordpress.com\/","postID":"109","gravDefault":"","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"1","userIsLoggedIn":"","isJetpack":"0","text_direction":"ltr"};
/* ]]> */
</script>
<script type='text/javascript' src='https://s2.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1424115551j'></script>

	<div id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id='bsub-text'>Follow</span></a>
		<div id="bitsubscribe">

					<h3><label for="loggedout-follow-field">Follow &ldquo;ample code&rdquo;</label></h3>

			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>

			<p id="loggedout-follow-error" style="display: none;"></p>

			
			<p><input type="email" name="email" placeholder="Enter your email address" id="loggedout-follow-field"/></p>

			<input type="hidden" name="action" value="subscribe"/>
			<input type="hidden" name="blog_id" value="1811208"/>
			<input type="hidden" name="source" value="https://einarwh.wordpress.com/2011/04/13/a-simple-lru-cache/"/>
			<input type="hidden" name="sub-type" value="loggedout-follow"/>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="4d957c637f" /><input type="hidden" name="_wp_http_referer" value="/2011/04/13/a-simple-lru-cache/" />
			<p id='bsub-subscribe-button'><input type="submit" value="Sign me up" /></p>
			</form>
					<div id='bsub-credit'><a href="https://wordpress.com/?ref=lof">Build a website with WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/einarwh.wordpress.com\/2011\/04\/13\/a-simple-lru-cache\/":109};
	</script>
		<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-twitter' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-facebook' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-google-plus-1' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
		});
		</script>
		<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/akismet-3.0/_inc/form.js?m=1404442431h'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var JetpackEmojiSettings = {"base_url":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/emoji\/twemoji\/"};
/* ]]> */
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/_static/??-eJyNy0sOwjAMRdENEUxRK2CAWEuUmtZuPiZOWpYPk0owoYzu4J0HixiXYsFYgBV6nMmhPPesO/iYQjXi60BRwdOECo+KFUcbe4/5B8aQmKAsX930jEWsm8x/ektJ0mLu3lIGHW2mOKx9n27h2rTd8dSc28OFXwesZFs='></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>	<script type="text/javascript">
	var skimlinks_pub_id = "725X584219"
	var skimlinks_sitename = "einarwh.wordpress.com";
	</script>
	<script type="text/javascript" src="https://s.skimresources.com/js/725X1342.skimlinks.js"></script>		<iframe src='https://widgets.wp.com/likes/master.html?ver=20160331#ver=20160331' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
		<div id='likes-other-gravatars'><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="//stats.wp.com/w.js?51" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'1811208','blog_tz':'0','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'1811208','v':'wpcom','tz':'0','user_id':'0','post':'109','subd':'einarwh'}]);
_stq.push(['extra', {'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRVz1bVXJlWWRQcV0mekNSTyUxZG0wTUlEalQ4ZFZIJS8mPW02YltdTFIzd3Rubks4VWVoNj1ZbE9YUUV5PSwtN2Z8JjVMXzdbRklaTWw/LUh1KyZwMFIrOWRTcEpkaisuZyx1bVUwWEsyVGJPaCtoQnRsOTdwSStQdElOTFQ9YVlkcVJiLVlZNHx2U0dTSVk1dHNLTV8xMmImZXJ4LUdybE1PLFd1WnVyXTgvZityNTBtOHwzWyVCSVFlfFdxays3Yi9rfDksNms2Ry5uZHxhamdPZyw3cCYwUVlwOEZm'}]);
_stq.push([ 'clickTrackerInit', '1811208', '109' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>		</div>
	</body>
</html>
